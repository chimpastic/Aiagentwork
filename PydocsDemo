import docx
import io
from PIL import Image  # Requires: pip install Pillow
import pytesseract     # Requires: pip install pytesseract
from docx.table import Table
from docx.text.paragraph import Paragraph

# IMPORTANT: pytesseract is a wrapper for Google's Tesseract-OCR engine.
# You MUST install Tesseract-OCR on your system for this code to work.
#
# Installation instructions:
# - Windows: https://github.com/UB-Mannheim/tesseract/wiki
# - macOS: brew install tesseract
# - Linux: sudo apt-get install tesseract-ocr
#
# After installing, you might need to tell pytesseract where to find it:
# Example: pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'

def extract_structured_content(doc_path):
    """
    Reads a .docx file and extracts text from paragraphs and tables
    in the order they appear in the document.
    """
    try:
        doc = docx.Document(doc_path)
    except Exception as e:
        print(f"Error opening document '{doc_path}': {e}")
        return []

    print(f"--- Processing Document: {doc_path} ---")

    extracted_data = []

    # We iterate through the 'body' which contains paragraphs and tables in order
    # doc.body.content contains both Paragraph and Table objects
    for block in doc.body.content:
        
        # Check if the block is a Paragraph
        if isinstance(block, Paragraph):
            text = block.text.strip()
            if text:  # Only add non-empty paragraphs
                extracted_data.append({
                    "type": "paragraph",
                    "content": text
                })
        
        # Check if the block is a Table
        elif isinstance(block, Table):
            table_data = []
            for row in block.rows:
                # Extract text from each cell in the row
                row_data = [cell.text.strip() for cell in row.cells]
                table_data.append(row_data)
            
            if table_data:
                extracted_data.append({
                    "type": "table",
                    "content": table_data
                })

    print(f"\n--- End of Processing ---")
    return extracted_data

# --- MAIN EXECUTION ---
if __name__ == "__main__":
    # Replace 'YOUR_DOCUMENT.docx' with the path to your Word file.
    # Make sure 'YOUR_DOCUMENT.docx' has at least one table and
    # at least one image that contains readable text.
    
    # doc_to_read = "YOUR_DOCUMENT.docx"
    # data = extract_structured_content(doc_to_read)
    
    print("Script is ready. Please uncomment the lines above and")
    print("replace 'YOUR_DOCUMENT.docx' with the actual file path to run.")
    
    # --- Example of how to print the structured data ---
    # print("\n--- Extracted Content (in order) ---")
    # if 'data' in locals():
    #     for item in data:
    #         if item['type'] == 'paragraph':
    #             print("\n[Paragraph]")
    #             print(item['content'])
            
    #         elif item['type'] == 'table':
    #             print("\n[Table]")
    #             for row in item['content']:
    #                 print(f"  {' | '.join(row)}")
    # else:
    #     print("\n(Uncomment main execution block to see output here)")


